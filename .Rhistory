scrape_txt_file <- function(year) {
# Download the file from the website and read its contents
txt_lines <- readLines(paste("https://kenpom.com/cbbga", year, ".txt", sep=""))
# Split each line by tab separator and convert to a dataframe
txt_df <- data.frame(do.call(rbind, strsplit(txt_lines, "\t")), stringsAsFactors = FALSE)
# Return the dataframe
return(txt_df)
}
year <- 23
remove(scrape_txt_file())
devtools::document()
year <- 23
txt_df <- scrape_txt_file(23)
txt_df
View(txt_df)
kenpom_reformat <- function(){
library(tidyverse)
download.file("http://kenpom.com/cbbga22.txt","cbb.txt")
cbb = read.fwf("cbb.txt", widths = c(10,24,4,22,5,3,20))
cbb = tibble(cbb)
## Renaming columns
cbb <- rename(cbb, Date = V1)
cbb <- rename(cbb, Away_team = V2)
cbb <- rename(cbb, Away_score = V3)
cbb <- rename(cbb,Home_team = V4)
cbb <- rename(cbb, Home_score = V5)
## Adding score difference
cbb <- cbb %>%
mutate(score_diff = Home_score - Away_score)
cbb = cbb %>%
mutate(Date = trimws(Date, which = "both"))
## Formatting date
library(lubridate)
cbb <- cbb %>%
mutate(Date = mdy(Date))
## Trimming home and away teams
cbb <- cbb %>%
mutate(Away_team = trimws(Away_team, which = "both"))
cbb <- cbb %>%
mutate(Home_team = trimws(Home_team, which = "both"))
## Arranging by location
cbb <- cbb %>%
mutate(V7 = trimws(V7, which = "both"))
cbb <- cbb %>%
mutate(site = ifelse(is.na(V7),Home_team, V7))
cbb <- cbb %>%
mutate(nuetral = ifelse(is.na(V7),0,1))
cbb <- arrange(cbb, site)
## Removing colums
cbb <- cbb %>% select(!(V6 | V7))
conf_teams <- read.csv("https://raw.githubusercontent.com/Gideonparry/MATH_3190_HW/main/kenpom22_conf.csv")
conf_teams <- conf_teams %>%
mutate(Date = mdy(Date))
cbb <- merge(x = cbb, y = conf_teams, by = c("Date", "Away_team"), all.x = TRUE)
return(cbb)
}
dad <- kenpom_reformat()
library(tidyverse)
